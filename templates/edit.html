<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Operação</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
</head>
<body>
    <main class="container">
        <nav>
          <ul>
            <li><img src="{{ url_for('static', filename='images/logofooter.png') }}" alt="Logo" style="height: 70px;"></li>
          </ul>
          <ul>
            <li><a href="{{ url_for('registros') }}">Ver Registros</a></li>
            <li><a href="{{ url_for('logout') }}" role="button" class="secondary outline">Sair</a></li>
          </ul>
        </nav>
        <hr>

        <h1>Editar Operação #{{ registro.id }}</h1>
        <form method="post">
            <div class="grid">
                <label for="nome_cliente">Nome do Cliente
                    <input type="text" id="nome_cliente" name="nome_cliente" value="{{ registro.nome_cliente }}" required>
                </label>
                <label for="cpf">CPF
                    <input type="text" id="cpf" name="cpf" value="{{ registro.cpf }}" required>
                </label>
            </div>
            
            <fieldset>
                <legend>Dados Financeiros Principais</legend>
                <div class="grid">
                    <label for="valor_contrato">Valor de Contrato (R$)
                        <input type="number" id="valor_contrato" name="valor_contrato" step="0.01" value="{{ registro.valor_contrato }}" required>
                    </label>
                    <label for="custo_produto">Custo do Produto (R$)
                        <input type="number" id="custo_produto" name="custo_produto" step="0.01" value="{{ registro.custo_produto }}" required>
                    </label>
                    <label for="percentual_comissao">% Comissão
                        <select id="percentual_comissao" name="percentual_comissao" required>
                            <option value="20" {% if registro.percentual_comissao == 20 %}selected{% endif %}>20%</option>
                            <option value="30" {% if registro.percentual_comissao == 30 %}selected{% endif %}>30%</option>
                        </select>
                    </label>
                </div>
            </fieldset>
            
            <fieldset>
                <legend>Dados do Investidor</legend>
                <div class="grid">
                    <label for="investidor">Investidor
                        <input type="text" id="investidor" name="investidor" value="{{ registro.investidor or '' }}">
                    </label>
                    <label for="valor_quitado">Valor Quitado (R$)
                        <input type="number" id="valor_quitado" name="valor_quitado" step="0.01" value="{{ registro.valor_quitado or '' }}">
                    </label>
                    <label for="percentual_investidor">% Investidor
                        <select id="percentual_investidor" name="percentual_investidor">
                            <option value="7" {% if registro.percentual_investidor == 7 %}selected{% endif %}>7%</option>
                            <option value="8" {% if registro.percentual_investidor == 8 %}selected{% endif %}>8%</option>
                            <option value="9" {% if registro.percentual_investidor == 9 %}selected{% endif %}>9%</option>
                            <option value="10" {% if registro.percentual_investidor == 10 %}selected{% endif %}>10%</option>
                        </select>
                    </label>
                </div>
                <label for="investidor_fora">
                    <input type="checkbox" id="investidor_fora" name="investidor_fora" value="1" {% if registro.investidor_fora %}checked{% endif %}>
                    Investidor de Fora
                </label>
            </fieldset>
            
            <fieldset>
                <legend>Detalhes da Operação</legend>
                <label for="bancos_quitados">Bancos Quitados
                    <input type="text" id="bancos_quitados" name="bancos_quitados" value="{{ registro.bancos_quitados or '' }}">
                </label>
                <div class="grid">
                    <label for="banco_contrato">Banco de Contrato (onde rodou)
                        <input type="text" id="banco_contrato" name="banco_contrato" value="{{ registro.banco_contrato or '' }}">
                    </label>
                    <label for="agencia">Agência
                        <input type="text" id="agencia" name="agencia" value="{{ registro.agencia or '' }}">
                    </label>
                </div>
            </fieldset>

            <div class="grid">
                <label for="supervisor">Supervisor
                    <input type="text" id="supervisor" name="supervisor" value="{{ registro.supervisor }}" required>
                </label>
                <label for="vendedor">Vendedor
                    <input type="text" id="vendedor" name="vendedor" value="{{ registro.vendedor }}" required>
                </label>
                <label for="data_quitacao">Data da Operação
                    <input type="date" id="data_quitacao" name="data_quitacao" value="{{ registro.data_quitacao }}" required>
                </label>
            </div>
            
            <hr>
            <h3>Líquido para Empresa: <span id="resultado_liquido">R$ 0,00</span></h3>
            <div class="grid">
                <button type="submit">Salvar Alterações</button>
                <a href="{{ url_for('registros') }}" role="button" class="secondary">Cancelar</a>
            </div>
        </form>
    </main>
    <script src="{{ url_for('static', filename='js/calculo.js') }}"></script>
    <script>
        // Dispara o cálculo inicial para mostrar o valor líquido atual
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('valor_contrato').dispatchEvent(new Event('input'));
        });
    </script>
</body>
</html>